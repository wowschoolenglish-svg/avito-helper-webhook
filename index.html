<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Avito OAuth — code</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; padding: 24px; max-width: 720px; margin: 0 auto; }
    pre { background:#f6f8fa; padding:12px; border-radius:8px; overflow:auto; }
    .ok { color:#0a7f2e; font-weight:600; }
    .warn { color:#b35a00; }
    .btn { display:inline-block; margin-top:8px; padding:8px 12px; border:1px solid #ddd; border-radius:6px; cursor:pointer; }
  </style>
</head>
<body>
  <h1>Avito OAuth: получен <code>code</code></h1>
  <div id="content"></div>

  <script>
    const params = new URLSearchParams(location.search);
    const code = params.get('code');
    const error = params.get('error');

    const el = document.getElementById('content');

    if (error) {
      el.innerHTML = '<p class="warn">Ошибка авторизации: <b>' + error + '</b></p>';
    } else if (code) {
      el.innerHTML = `
        <p class="ok">Код успешно получен.</p>
        <p>Скопируйте этот <code>code</code> и обменяйте его на токены с вашего компьютера (curl / Python).</p>
        <pre id="codeBox">${code}</pre>
        <button class="btn" onclick="copy()">Скопировать</button>
        <h3>Шаблон curl для обмена:</h3>
<pre>curl -X POST https://api.avito.ru/token \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "grant_type=authorization_code" \
  -d "client_id=ВАШ_CLIENT_ID" \
  -d "client_secret=ВАШ_CLIENT_SECRET" \
  -d "code=${code}" \
  -d "redirect_uri=https://www.dialog-assistant.ru/callback/avito"</pre>
        <p>В ответ придут <code>access_token</code> (живёт ~24ч) и <code>refresh_token</code> (до года). Их нужно записать в <code>.env</code> вашего помощника:</p>
<pre>AVITO_AUTH_ACCESS_TOKEN=&lt;access_token&gt;
AVITO_AUTH_REFRESH_TOKEN=&lt;refresh_token&gt;</pre>
      `;
    } else {
      el.innerHTML = '<p class="warn">В запросе нет параметра <code>code</code>. Откройте ссылку авторизации ещё раз.</p>';
    }

    function copy() {
      const t = document.getElementById('codeBox').innerText;
      navigator.clipboard.writeText(t);
    }
  </script>
</body>
</html>
